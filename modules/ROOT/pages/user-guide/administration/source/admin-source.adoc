== Lisk Core Source Administration

This section details how to manage a Source installation of Lisk Core.

[width="100%",cols="50%,50%",options="header",]
|===
|Info |Note
|image:../../../modules/ROOT/assets/info-icon.png[info
note,title="Info Note"] |Source installations are recommended to use a
process manager. We use PM2 for this purpose. If you have not set it up
yet, please refer to the link:../../../setup/source/source.md[Setup from
Source] page.
|===

* link:#basic-commands[Basic Commands]
** link:#status[Status of Lisk Core]
** link:#start[Start Lisk Core]
** link:#stop[Stop Lisk Core]
** link:#restart[Restart Lisk Core]
** link:#delete[Delete Lisk Core]
** link:#add[Add Lisk Core]
** link:#logs[Logs]
* link:#command-line-options[Command Line Options]
* link:#utility-scripts[Utility scripts]
** link:#generate-config[Generate Config]
** link:#update-config[Update Config]
** link:#console[Console]
* link:#rebuild-from-a-snapshot[Rebuild from Snapshot]

=== Basic Commands

==== Status

Check the status of the Lisk Core Node.

[source,bash]
----
pm2 status lisk
----

==== Start

Start Lisk Core.

[source,bash]
----
pm2 start lisk
----

==== Stop

Stop Lisk Core.

[source,bash]
----
pm2 stop lisk
----

==== Restart

Restart Lisk Core.

[source,bash]
----
pm2 restart lisk
----

==== Delete

Remove Lisk Core process from pm2 list.

[source,bash]
----
pm2 delete lisk
----

==== Add

In case you haven’t done this during the Installation process, add your
Lisk Core process to pm2 under the name `+lisk+`.

[source,bash]
----
pm2 start --name lisk app.js -- --network [network]
----

Where `+[network]+` might be either `+testnet+` or `+mainnet+`.

==== Logs

Display Lisk Core logs in streaming.

[source,bash]
----
pm2 logs
----

=== Command Line Options

There are plenty of options available that you can use to override
configuration on runtime while starting Lisk Core.

[source,bash]
----
node app.js -p [port] -a [address] -c [config-path] -n [network]
----

or with pm2, e.g.:

[source,bash]
----
pm2 start lisk -p [port] -a [address] -c [config-path] -n [network]
----

You can pass any of `+devnet+` (default), `+alphanet+`, `+betanet+`,
`+testnet+` or `+mainnet+` for the network option.

Each of these options can be appended on command line. There are also
few `+ENV+` variables that can be utilized for this purpose.

[cols=",,,",options="header",]
|===
|Option |ENV Variable |Config Option |Description
|===

|

....
| LISK_NETWORK           |                          | Which configurations set to use, associated to lisk networks. Any of this option can be used `devnet`, `alphanet`, `betanet`, `testnet` and `mainnet`. Default value is `devnet`. |
....

|

....
| LISK_CONFIG_FILE       |                          | Path the custom configuration file, which will override values of `config/default/config.json`                                                                                    |
....

|

....
  | LISK_WS_PORT           | wsPort                   | TCP port for P2P layer                                                                                                                                                            |
....

|

| LISK_HTTP_PORT | httpPort | TCP port for HTTP API | |

| LISK_ADDRESS | address | Listening host name or ip | |

....
   | LISK_FILE_LOG_LEVEL    | fileLogLevel             | Log level for file output                                                                                                                                                         |
....

| | LISK_CONSOLE_LOG_LEVEL | consoleLogLevel | Log level for console
output | | | LISK_CACHE_ENABLED | cacheEnabled | Enable or disable
cache. Must be set to true/false | |

| LISK_DB_NAME | db.database | PostgreSQL database name to connect to |
| | LISK_DB_HOST | db.host | PostgreSQL database host name | | |
LISK_DB_PORT | db.port | PostgreSQL database port | | | LISK_DB_USER |
db.user | PostgreSQL database username to connect to | | |
LISK_DB_PASSWORD | db.password | PostgreSQL database password to connect
to | |

....
 | LISK_REDIS_HOST        | redis.host               | Redis host name                                                                                                                                                                   |
....

| | LISK_REDIS_PORT | redis.port | Redis port | | | LISK_REDIS_DB_NAME |
redis.db | Redis database name to connect to | | |
LISK_REDIS_DB_PASSWORD | redis.password | Redis database password to
connect to | |

....
 | LISK_PEERS             | peers.list               | Comma separated list of peers to connect to in the format `192.168.99.100:5000,172.169.99.77:5000`                                                                                |
....

| | LISK_API_PUBLIC | api.access.public | Enable or disable public
access of http API. Must be set to true/false | | | LISK_API_WHITELIST |
api.access.whiteList | Comma separated list of IPs to enable API access.
Format `+192.168.99.100,172.169.99.77+` | | | LISK_FORGING_DELEGATES |
forging.delegates | Comma separated list of delegates to load in the
format _publicKey|encryptedPassphrase,publicKey2|encryptedPassphrase2_ |
| | LISK_FORGING_WHITELIST | forging.access.whiteList | Comma separated
list of IPs to enable access to forging endpoints. Format
`+192.168.99.100,172.169.99.77+` | |

| | | Number of round for which take the snapshot. If none specified it
will use the highest round available. |

==== Note

* All `+ENV+` variables restricted with operating system constraint of
`+ENV+` variable maximum length.
* Comma separated lists will replace the original config values. e.g. If
you specify `+LISK_PEERS+`, original `+peers.list+` specific to network
will be replaced completely.

=== Utility scripts

There are couple of command line scripts that facilitate users of lisk
to perform handy operations.

All scripts are are located under `+./scripts/+` directory and can be
executed directly by `+node scripts/<file_name>+`.

==== Generate Config

This script will help you to generate unified version of configuration
file for any network. Here is the usage of the script:

[source,bash]
----
Usage: node scripts/generate_config.js [options]

Options:

-h, --help               output usage information
-V, --version            output the version number
-c, --config [config]    custom config file
-n, --network [network]  specify the network or use LISK_NETWORK
----

Argument `+network+` is required and can by `+devnet+`, `+testnet+`,
`+mainnet+` or any other network folder available under `+./config+`
directory.

==== Update Config

This script keep track of all changes introduced in Lisk over time in
different versions. If you have one config file in any of specific
version and you want to make it compatible with other version of the
Lisk, this scripts will do it for you.

[source,bash]
----
Usage: node scripts/update_config.js [options] <input_file> <from_version> [to_version]

Options:

-h, --help               output usage information
-V, --version            output the version number
-n, --network [network]  specify the network or use LISK_NETWORK
-o, --output [output]    output file path
----

As you can see from the usage guide, `+input_file+` and`+from_version+`
are required. If you skip `+to_version+` argument changes in config.json
will be applied up to the latest version of Lisk Core. If you do not
specify `+--output+` path the final config.json will be printed to
stdout. If you do not specify `+--network+` argument you will have to
load it from `+LISK_NETWORK+` env variable.

==== Console

This script is really useful in development. It will initialize the
components of Lisk and load these into nodejs REPL.

[source,bash]
----
Usage: node scripts/console.js

initApplication: Application initialization inside test environment started...
initApplication: Target database - lisk_dev
initApplication: Rewired modules available
initApplication: Fake onBlockchainReady event called
initApplication: Loading delegates...
initApplication: Delegates loaded from config file - 101
initApplication: Done
lisk-core [lisk_dev] >
----

Once you get the prompt, you can use `+modules+`, `+helpers+`,
`+logic+`, `+db+` and `+config+` objects and play with these in REPL.

=== Rebuild from a snapshot

In some scenarios it is recommended to restore the blockchain from a
snapshot. The command blocks below will perform this process. The URL
can be substituted for another `+blockchain.db.gz+` snapshot file if
desired.

==== Mainnet

[source,bash]
----
pm2 stop lisk
dropdb lisk_main
wget https://downloads.lisk.io/lisk/main/blockchain.db.gz
createdb lisk_main
gunzip -fcq blockchain.db.gz | psql -d lisk_main
pm2 start lisk
----

==== Testnet

[source,bash]
----
pm2 stop lisk
dropdb lisk_test
wget https://downloads.lisk.io/lisk/test/blockchain.db.gz
createdb lisk_test
gunzip -fcq blockchain.db.gz | psql -d lisk_test
pm2 start lisk
----
